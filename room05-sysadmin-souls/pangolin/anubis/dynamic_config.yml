http:
  middlewares:
    ratelimit:
      rateLimit:
        average: 100
        burst: 200
        period: 1m

  routers:
    pangolin:
      rule: "Host(`cloud.reta.re`)"
      service: inner-traefik
      middlewares:
        - ratelimit
      entryPoints:
        - websecure

    services:
      priority: 1
      rule: "PathRegexp(`.*`)"
      service: inner-traefik
      entryPoints:
        - anubis

    # Anubis router
    anubis:
      # Setting Anubis to the lowest priority, so it only takes the slack
      priority: 1
      # wildcard match anything
      rule: "PathRegexp(`.*`)"
      service: anubis
      middlewares:
        - ratelimit
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

  services:
    anubis:
      loadBalancer:
        servers:
          - url: "http://anubis:8888" # Anubis port
    inner-traefik:
      loadBalancer:
        servers:
          - url: "https://gerbil:443"
